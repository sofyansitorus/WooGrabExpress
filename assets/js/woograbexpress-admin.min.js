!function(e){"use strict";var t={_inputLatId:"woocommerce_woograbexpress_origin_lat",_inputLngId:"woocommerce_woograbexpress_origin_lng",_mapWrapperId:"woograbexpress-map-wrapper",_mapSearchId:"woograbexpress-map-search",_mapCanvasId:"woograbexpress-map-canvas",_zoomLevel:16,_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",init:function(){var t=this;woograbexpress_params.show_settings&&setTimeout(function(){for(var t=!1,o=e(document).find(".wc-shipping-zone-method-type"),a=0;a<o.length;a++){var r=o[a];if(e(r).text()==woograbexpress_params.method_title)return e(r).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(t=!0)}t||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(woograbexpress_params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===woograbexpress_params.method_title&&t._initGoogleMaps()})},_initGoogleMaps:function(t){var o=this;e("#"+o._inputLatId).closest("tr").hide(),e("#"+o._inputLngId).closest("tr").hide();try{if("undefined"==typeof google||void 0===google.maps)throw"google is not defined";o._buildGoogleMaps()}catch(t){e.getScript("https://maps.googleapis.com/maps/api/js?key="+o._decode(e("#map-secret-key").val())+"&libraries=geometry,places&&language="+woograbexpress_params.language,function(){o._buildGoogleMaps()})}},_buildGoogleMaps:function(){var t=this,o=-6.175392,a=106.827153,r=e("#"+t._inputLatId).val(),n=e("#"+t._inputLngId).val(),s={lat:r=r.length?parseFloat(r):o,lng:n=n.length?parseFloat(n):a},i=wp.template(t._mapCanvasId),g=wp.template(t._mapSearchId);e("#"+t._mapCanvasId).length||e("#"+t._mapWrapperId).append(i({map_canvas_id:t._mapCanvasId}));var d=[],p=new google.maps.Map(document.getElementById(t._mapCanvasId),{center:s,zoom:t._zoomLevel,mapTypeId:"roadmap"}),c=new google.maps.Marker({map:p,position:s,draggable:!0,icon:woograbexpress_params.marker}),m=new google.maps.InfoWindow({maxWidth:350});r==o&&n==a?(m.setContent(woograbexpress_params.txt.drag_marker),m.open(p,c)):t._setLatLng(c.position,c,p,m),google.maps.event.addListener(c,"dragstart",function(e){m.close()}),google.maps.event.addListener(c,"dragend",function(e){t._setLatLng(e.latLng,c,p,m)}),d.push(c),e("#"+t._mapSearchId).length||e("#"+t._mapWrapperId).append(g({map_search_id:t._mapSearchId}));var l=document.getElementById(t._mapSearchId),h=new google.maps.places.SearchBox(l);p.controls[google.maps.ControlPosition.TOP_LEFT].push(l),p.addListener("bounds_changed",function(){h.setBounds(p.getBounds())}),h.addListener("places_changed",function(){var e=h.getPlaces();if(0!==e.length){d.forEach(function(e){e.setMap(null)}),d=[];var o=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(c=new google.maps.Marker({map:p,position:e.geometry.location,draggable:!0,icon:woograbexpress_params.marker}),t._setLatLng(e.geometry.location,c,p,m),google.maps.event.addListener(c,"dragstart",function(e){m.close()}),google.maps.event.addListener(c,"dragend",function(e){t._setLatLng(e.latLng,c,p,m)}),d.push(c),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),p.setZoom(t._zoomLevel),p.fitBounds(o)}}),setInterval(function(){e(".gm-err-content").length&&(e("#"+t._mapCanvasId).closest("tr").hide(),e("#"+t._inputLatId).closest("tr").show(),e("#"+t._inputLngId).closest("tr").show(),google=void 0)},1e3)},_setLatLng:function(t,o,a,r){var n=this;(new google.maps.Geocoder).geocode({latLng:t},function(s,i){i==google.maps.GeocoderStatus.OK&&(s[0]?(r.setContent(s[0].formatted_address),r.open(a,o),e("#"+n._inputLatId).val(t.lat()),e("#"+n._inputLngId).val(t.lng())):(e("#"+n._inputLatId).val(""),e("#"+n._inputLngId).val("")))}),a.setCenter(t)},_encode:function(e){var t,o,a,r,n,s,i,g="",d=0;for(e=this._utf8_encode(e);d<e.length;)r=(t=e.charCodeAt(d++))>>2,n=(3&t)<<4|(o=e.charCodeAt(d++))>>4,s=(15&o)<<2|(a=e.charCodeAt(d++))>>6,i=63&a,isNaN(o)?s=i=64:isNaN(a)&&(i=64),g=g+this._keyStr.charAt(r)+this._keyStr.charAt(n)+this._keyStr.charAt(s)+this._keyStr.charAt(i);return g},_decode:function(e){var t,o,a,r,n,s,i="",g=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");g<e.length;)t=this._keyStr.indexOf(e.charAt(g++))<<2|(r=this._keyStr.indexOf(e.charAt(g++)))>>4,o=(15&r)<<4|(n=this._keyStr.indexOf(e.charAt(g++)))>>2,a=(3&n)<<6|(s=this._keyStr.indexOf(e.charAt(g++))),i+=String.fromCharCode(t),64!=n&&(i+=String.fromCharCode(o)),64!=s&&(i+=String.fromCharCode(a));return i=this._utf8_decode(i)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",o=0;o<e.length;o++){var a=e.charCodeAt(o);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode:function(e){for(var t="",o=0,a=0,r=0;o<e.length;)(a=e.charCodeAt(o))<128?(t+=String.fromCharCode(a),o++):a>191&&a<224?(r=e.charCodeAt(o+1),t+=String.fromCharCode((31&a)<<6|63&r),o+=2):(r=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&a)<<12|(63&r)<<6|63&c3),o+=3);return t}};e(document).ready(function(){t.init()})}(jQuery);