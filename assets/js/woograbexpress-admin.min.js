!function(e){"use strict";var o={inputLatId:"woocommerce_woograbexpress_origin_lat",inputLngId:"woocommerce_woograbexpress_origin_lng",mapWrapperId:"woograbexpress-map-wrapper",mapSearchId:"woograbexpress-map-search",mapCanvasId:"woograbexpress-map-canvas",zoomLevel:16,init:function(){var o=this;woograbexpress_params.show_settings&&setTimeout(function(){for(var o=!1,a=e(document).find(".wc-shipping-zone-method-type"),t=0;t<a.length;t++){var n=a[t];if(e(n).text()==woograbexpress_params.method_title)return e(n).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(o=!0)}o||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(woograbexpress_params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===woograbexpress_params.method_title&&o._initGoogleMaps()})},_initGoogleMaps:function(){var o=this;try{if("undefined"==typeof google||void 0===google.maps)throw"google is not defined";o._buildGoogleMaps()}catch(a){e.getScript("https://maps.googleapis.com/maps/api/js?key=&libraries=geometry,places",function(){o._buildGoogleMaps()})}},_buildGoogleMaps:function(){var o=this,a=e("#"+o.inputLatId).val(),t=e("#"+o.inputLngId).val(),n={lat:a=a.length?parseFloat(a):-6.175392,lng:t=t.length?parseFloat(t):106.827153},s=wp.template(o.mapCanvasId),r=wp.template(o.mapSearchId);e("#"+o.mapCanvasId).length||e("#"+o.mapWrapperId).append(s({map_canvas_id:o.mapCanvasId}));var p=[],g=new google.maps.Map(document.getElementById(o.mapCanvasId),{center:n,zoom:o.zoomLevel,mapTypeId:"roadmap"}),i=new google.maps.Marker({map:g,position:n,draggable:!0,icon:woograbexpress_params.marker}),d=new google.maps.InfoWindow({maxWidth:350,content:woograbexpress_params.txt.drag_marker});d.open(g,i),google.maps.event.addListener(i,"dragstart",function(e){d.close()}),google.maps.event.addListener(i,"dragend",function(e){o._setLatLng(e.latLng,i,g,d)}),p.push(i),e("#"+o.mapSearchId).length||e("#"+o.mapWrapperId).append(r({map_search_id:o.mapSearchId}));var m=document.getElementById(o.mapSearchId),l=new google.maps.places.SearchBox(m);g.controls[google.maps.ControlPosition.TOP_LEFT].push(m),g.addListener("bounds_changed",function(){l.setBounds(g.getBounds())}),l.addListener("places_changed",function(){var e=l.getPlaces();if(0!=e.length){p.forEach(function(e){e.setMap(null)}),p=[];var a=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(i=new google.maps.Marker({map:g,position:e.geometry.location,draggable:!0,icon:woograbexpress_params.marker}),o._setLatLng(e.geometry.location,i,g,d),google.maps.event.addListener(i,"dragstart",function(e){d.close()}),google.maps.event.addListener(i,"dragend",function(e){o._setLatLng(e.latLng,i,g,d)}),p.push(i),e.geometry.viewport?a.union(e.geometry.viewport):a.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),g.setZoom(o.zoomLevel),g.fitBounds(a)}})},_setLatLng:function(o,a,t,n){var s=this;(new google.maps.Geocoder).geocode({latLng:o},function(r,p){p==google.maps.GeocoderStatus.OK&&(r[0]?(n.setContent(r[0].formatted_address),n.open(t,a),e("#"+s.inputLatId).val(o.lat()),e("#"+s.inputLngId).val(o.lng())):(e("#"+s.inputLatId).val(""),e("#"+s.inputLngId).val("")))}),t.setCenter(o)}};e(document).ready(function(){o.init()})}(jQuery);